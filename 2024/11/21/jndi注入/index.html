<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    jndi注入 丨
    

    typo
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Leo的随便写写</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">jndi注入</div>
  <div class="post-meta">
    <div class="date">2024 November 21st</div>
    <div class="tags">
      
      <div class="tag-item">安全技术</div>
      
    </div>
  </div>
  

  <main class="post-content"><p><strong>(Java Naming and Directory Interface) 是一个应用程序设计的 API，为开发人员提供了查找和访问各种命名和目录服务的通用、统一的接口。</strong></p>
<h4 id="主要支持的服务"><a href="#主要支持的服务" class="headerlink" title="主要支持的服务"></a>主要支持的服务</h4><ul>
<li><strong>RMI（java远程方法调用）</strong></li>
<li><strong>LDAP(轻量级目录访问协议)</strong></li>
<li>CORBA（公共对象请求代理体系结构）</li>
<li>DNS（域名服务）</li>
</ul>
<p><strong>JNDI中有两个方法：</strong></p>
<ul>
<li>bind() :作用是将名称绑定到对象里面</li>
<li>lookup() :作用是通过名字检索执行的对象</li>
</ul>
<p>JNDI注入简单来说就是在JNDI接口在初始化时，如果lookup()方法的参数可控，攻击者就可以将恶意的url传入参数加载恶意的类。</p>
<pre><code class="highlight plaintext">import javax.naming.InitialContext;
import javax.naming.NamingException;

public class jndi &#123;
    public static void main(String[] args) throws NamingException &#123;
        String uri = &quot;rmi://127.0.0.1:1099/work&quot;;
        InitialContext initialContext = new InitialContext();//得到初始目录环境的一个引用
        initialContext.lookup(uri);//获取指定的远程对象
    &#125;
&#125;</code></pre>

<h3 id="应用："><a href="#应用：" class="headerlink" title="应用："></a>应用：</h3><h4 id="fastjson反序列化漏洞"><a href="#fastjson反序列化漏洞" class="headerlink" title="fastjson反序列化漏洞"></a>fastjson反序列化漏洞</h4><h4 id="log4j-反序列化-rmi-ldap"><a href="#log4j-反序列化-rmi-ldap" class="headerlink" title="log4j 反序列化 rmi&#x2F;ldap"></a>log4j 反序列化 rmi&#x2F;ldap</h4><p>lookup（url）方法的参数可以由用户操控–》 ldap:&#x2F;&#x2F;IP&#x2F;exploit(一个类)</p>
<ul>
<li>启动rmi服务端（工具：mash）漏洞端可以访问到该服务端，返回一个http地址（包含服务端2中的ref对象）</li>
<li>服务端2，返回ref对象。（有攻击payload，那个exploit类）</li>
</ul>
<p>漏洞端执行了ref对象（whoami）</p>
<p>log4jpayload 用DNS服务情况下，可以探测漏洞是否存在，不暴露自己服务器地址，开销小速度快</p>
<p>代码审计：找lookup的参数，是否用户可控</p>
<p>工具：JNDIExploit，本地启动ldap&#x2F;rmi服务 本地又启动一个http，放置恶意类</p>
<p><code>java -jar JNDIExploit-1.4-SNAPSHOT.jar -i vps_ip -l 1389-p 8090</code></p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2024 typo</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>